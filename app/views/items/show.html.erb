<div class="back">
  <%= back_link %>
</div>
<div class="row">
  <section class="col-xs-12 col-sm-5 main-info">
    <h3 class="table-heading"><%= @item.name %></h3>
    <p><span>Id: </span><%= @item.id %></p>
    <p><span>Status: </span><%= @item.working? ? "working" : "Not Working" %></p>

    <% if @item.model_number.present? %>
      <p><span>Model Number: </span><%= @item.model_number %></p>
    <% end %>

    <p><span>Serial Number: </span><%= @item.serial_number %></p>
    <p>
      <% if @item.vendor.present? || @item.purchase_on.present? %>
        <span>Purchased: </span>

        <% if @item.vendor.present? %>
          from <%= link_to @item.vendor.name, vendor_path(@item.vendor) %>
        <% end %>

        <% if @item.purchase_on.present? %>
          on <%= format_date(@item.try(:purchase_on)) %>
        <% end %>
      <% end %>
    </p>
    <% if @item.warranty_expires_on.present? %>
      <p><span>Warranty Expires On: </span><%= format_date(@item.warranty_expires_on) %></p>
    <% end %>

    <% if @item.employee.present? %>
      <p><span>Allocated To: </span><%= link_to @item.employee.try(:name), employee_path(@item.employee_id) %></p>
    <% end %>

    <p>
      <% if @item.unavailable? %>
        <span>Checkout: </span>
        <%= checkout_details(@item)%>
      <% else %>
        <span>Status: </span><%= @item.working? ? "Working" : "Non-Working" %>
      <% end %>
    </p>

    <%= edit_link(edit_item_path(@item), "Item") %>

    <% if @item.discarded_at.nil? %>
      <%= link_to allocation_type(@item), allocate_item_path(@item), data: { remote_popup: true, title: allocation_type(@item) }, class: "btn btn-primary btn-sm" %>
      <%= link_to 'New Issue', new_issue_path(item_id: @item), data: { remote_popup: true, title: "Create Issue" }, class: "btn btn-primary btn-sm" %>
      <%= delete_link(item_path(@item)) %>
    <% end %>
  </section>
  <section class="col-xs-12 col-sm-7 other-info">
    <h3>Item History (<%= @item_histories.count %>)</h3>
    <div class="table-responsive">
      <table class="table table-striped">
        <tr>
          <th class="twohundred">System</th>
          <th class="twohundred">Allocated To</th>
          <th class="onefourty">Status</th>
          <th class="hundred">Date</th>
        </tr>
        <% @item_histories.each do |item_history| %>
          <tr>
            <td>
              <% if item_history.system.present? %>
                <%= link_to "#{item_history.system.name}", system_path(item_history.system) %>
              <% else %>
                Unattached
              <% end %>
            </td>
            <td>
              <% if item_history.employee.present? %>
                <%= link_to item_history.employee.try(:name), employee_path(item_history.employee_id) %>
              <% else %>
                Unallocated
              <% end %>
            </td>
            <td><%= item_history.status? ? "Active" : "Inactive" %></td>
            <td><%= format_date(item_history.created_at) %></td>
          </tr>
        <% end %>
      </table>
      <%= will_paginate @item_histories, param_name: 'item_histories_page' %>
    </div>
    <h3>Checkouts History (<%= @checkouts.count %>)</h3>
    <div class="table-responsive">
      <table class="table table-striped table-last">
        <tr>
          <th class="twohundred">Employee</th>
          <th class="twohundred">Checkout</th>
          <th class="onefourty">Checkin</th>
          <th class="hundred">&nbsp;</th>
        </tr>
        <% @checkouts.each do |checkout| %>
          <tr>
            <td><%= link_to checkout.employee.try(:name), employee_path(checkout.employee_id) if checkout.employee.present? %></td>
            <td><%= format_date(checkout.checkout) %></td>
            <td><%= format_date(checkout.check_in) %></td>
            <td><%= show_link(checkout_path(checkout)) %></td>
          </tr>
        <% end %>
      </table>
      <%= will_paginate @checkouts, param_name: 'checkouts_page' %>
    </div>
    <h3>Issues (<%= @issues.count %>)</h3>
    <div class="table-responsive">
      <table class="table table-striped table-last">
        <tr>
          <th class="twohundred">Issue</th>
          <th class="twohundred">System</th>
          <th class="onefourty">Closed At</th>
          <th class="hundred">&nbsp;</th>
        </tr>
        <% @issues.each do |issue| %>
          <tr>
            <td><%= link_to issue.title, issue_path(issue) %></td>
            <td><%= link_to issue.system.name, system_path(issue.system) if issue.system_id? %></td>
            <td><%= format_date(issue.closed_at) if issue.closed_at? %></td>
            <td><%= show_link(issue_path(issue)) %></td>
          </tr>
        <% end %>
      </table>
      <%= will_paginate @issues, param_name: 'issues_page' %>
    </div>
  </div>
</div>
