<div class="page-header">
  <%= link_to t('button.add'), new_item_path, data: { remote_popup: true, title: t('.add.popup.title') },  class: "btn btn-primary pull-right" %>
  <h3><%= t('.heading') %></h3>
</div>
<div class="table-responsive">
  <table class="table table-striped item-index">
    <tr>
      <th><%= t('.table.th.id') %></th>
      <th><%= t('.table.th.item') %></th>
      <th><%= t('.table.th.model_number') %></th>
      <th><%= t('.table.th.serial_number') %></th>
      <th><%= t('.table.th.issue') %></th>
      <th><%= t('.table.th.checkout') %></th>
      <th><%= t('.table.th.status') %></th>
      <th></th>
      <th></th>
    </tr>
    <% @items.each do |item| %>
      <tr>
        <td><%= link_to item.id, item_path(item) %></td>
        <td><%= link_to item.name, item_path(item) %></td>
        <td><%= item.model_number %></td>
        <td><%= item.serial_number %></td>
        <td>
          <% if item.issues.present? %>
            <% if item.issues.unclosed.count > 0 %>
              <%= link_to "#{t('.table.td.unclosed')} (#{item.issues.unclosed.count})", issues_path(item_id: item.id) %>
            <% else %>
              <%= link_to t('.table.td.closed'), issues_path(item_id: item.id) %>
            <% end %>
          <% else %>
            <%= t('.table.td.no_issue') %>
          <% end %>
        </td>
        <td>
          <% if item.checkouts.present? %>
            <% if item.unavailable? %>
              <%= checkout_details(item) %>
            <% else %>
              <%= link_to t('.table.td.checkouts'), checkouts_path(item_id: item.id) %>
            <% end %>
          <% end %>
        </td>
        <td>
          <%= item.working? ? t('.table.td.working') : t('.table.td.non_working') %>
        </td>
        <td>
          <%= edit_link(edit_item_path(item), t('.edit.popup.title')) %>
        </td>
        <td>
          <% if item.discarded_at.nil? %>
            <%= link_to allocation_type(item), allocate_item_path(item), data: { remote_popup: true, title: allocation_type(item) }, class: "btn btn-primary btn-sm btn-allocate" %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </table>
</div>
<%= will_paginate %>
