<div class="page-header">
  <%= link_to 'Add', new_item_path, data: { remote_popup: true, title: "Create Item" },  class: "btn btn-primary pull-right" %>
  <h3>Items</h3>
</div>
<div class="table-responsive">
  <table class="table table-striped table-last">
    <tr>
      <th>Id</th>
      <th>Item</th>
      <th>Model Number</th>
      <th>Serial Number</th>
      <th>Issue</th>
      <th>Checkout</th>
      <th>Status</th>
      <th>&nbsp;</th>
    </tr>
    <% @items.each do |item| %>
      <tr class="<%= 'pending' if item.unavailable? %>">
        <td><%= link_to item.id, item_path(item) %></td>
        <td><%= link_to item.name, item_path(item) %></td>
        <td><%= item.model_number %></td>
        <td><%= item.serial_number %></td>
        <td>
          <% if item.issues.present? %>
            <% if item.issues.unclosed.count > 0 %>
              <%= link_to "unclosed (#{item.issues.unclosed.count})", issues_path(item_id: item.id) %>
            <% else %>
              <%= link_to "closed", issues_path(item_id: item.id) %>
            <% end %>
          <% else %>
            No Issue
          <% end %>
        </td>
        <td>
          <% if item.checkouts.present? %>
            <% if item.checkouts.order_desending.last.check_in.nil? %>
              <%= format_date(item.checkouts.order_desending.first.checkout) %>
            <% else %>
              <%= link_to "checkouts", checkouts_path(item_id: item.id) %>
            <% end %>
          <% end %>
        </td>
        <td>
          <label class="switch">
            <%= check_box_tag 'Status', item.working, item.working, data: { remote: true, url: url_for( action: 'toggle_status', id: item.id, working: item.working ), method: :put } %>
            <div class="slider round"></div>
          </label>
        </td>
        <td>
          <%= edit_link(edit_item_path(item), "Item") %>
          <%= link_to 'Allocate', allocate_item_path(item), data: { remote_popup: true, title: "Allocate/Deallocate" }, class: "btn btn-primary btn-sm" %>
        </td>
      </tr>
    <% end %>
  </table>
</div>
<%= will_paginate %>
