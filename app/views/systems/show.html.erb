<div class="back">
  <%= back_link %>
</div>
<div class="row">
  <section class="col-xs-12 col-sm-5 main-info">
    <h3><%= @system.name %></h3>
    <p><span><%= t('.id') %> </span><%= @system.id %></p>

    <% if @system.assembled_on.present? %>
      <p><span><%= t('.assembled') %> </span><%= format_date(@system.assembled_on) %></p>
    <% end %>

    <% if @system.employee.present? %>
      <p><span><%= t('.allocated') %> </span><%= link_to @system.employee.name, employee_path(@system.employee_id) %></p>
    <% end %>

    <% if @system.discarded_at.present? %>
      <p><span><%= t('.discarded') %> </span><%= format_date(@system.discarded_at) %></p>
    <% end %>

    <p><span><%= t('.status') %> </span><%= @system.working ? t('.working') : t('.not_working') %></p>

    <% if @system.note.present? %>
      <p><span><%= t('.note') %> </span><%= @system.note %></p>
    <% end %>

    <p><span><%= t('.items') %> </span>
      <ol>
        <% @system.items.each do |item| %>
          <li><%= link_to item.name, item_path(item) %></li>
        <% end %>
      </ol>
    </p>
    <%= edit_link(edit_system_path(@system), t('.edit.popup.title')) %>
  </section>
  <section class="col-xs-12 col-sm-7 other-info">
    <h3><%= t('.system_history.heading') %> (<%= @system_histories.count %>)</h3>
    <div class="table-responsive">
      <table class="table table-striped">
        <tr>
          <th class="fourty"><%= t('.system_history.table.th.employee') %></th>
          <th class="thirty"><%= t('.system_history.table.th.status') %></th>
          <th class="thirty"><%= t('.system_history.table.th.date') %></th>
        </tr>
        <% @system_histories.each do |system_history| %>
          <tr>
            <td>
              <% if system_history.employee.present? %>
                <%= link_to system_history.employee.try(:name), employee_path(system_history.employee_id) %>
              <% else %>
                <%= t('.system_history.table.td.unassigned') %>
              <% end %>
            </td>
            <td><%= system_history.status? ?  t('.working') : t('.not_working') %></td>
            <td><%= format_date(system_history.created_at) %></td>
          </tr>
        <% end %>
      </table>
      <%= will_paginate @system_histories, param_name: 'system_histories_page' %>
    </div>
    <h3 class="table-heading"><%= t('.issue.heading') %> (<%= @issues.count %>)</h3>
    <div class="table-responsive">
      <table class="table table-striped table-last">
        <tr>
          <th class="fourty"><%= t('.issue.table.th.issue') %></th>
          <th class="thirty"><%= t('.issue.table.th.item') %></th>
          <th class="tweentyfive"><%= t('.issue.table.th.closed') %></th>
          <th class="five"></th>
        </tr>
        <% @issues.each do |issue| %>
          <tr>
            <td><%= link_to issue.title,issue_path(issue) %></td>
            <td><%= link_to issue.item.name, item_path(issue.item) if issue.item_id? %></td>
            <td><%= format_date(issue.closed_at) if issue.closed_at? %></td>
            <td><%= show_link(issue_path(issue)) %></td>
          </tr>
        <% end %>
      </table>
      <%= will_paginate @issues, param_name: 'issues_page' %>
    </div>
  </section>
</div>
